paths:
  /internal/auth/register:
    post:
      operationId: registerUser
      summary: Register a new user
      description: Creates a new user account. An email verification link will be sent to the provided email address. The user must verify their email before they can log in.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - email
                - password
              properties:
                name:
                  type: string
                  example: John Doe
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: securepassword123
      responses:
        "201":
          description: User registered successfully. Verification email sent.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Registration successful. Please check your email to verify your account.
        "400":
          $ref: "#/components/responses/Error"
        "409":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/login:
    post:
      operationId: loginUser
      summary: Login with email and password
      description: Authenticates a user and returns a JWT token. The user's email must be verified before login is allowed.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                password:
                  type: string
                  format: password
                  example: securepassword123
      responses:
        "200":
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                    description: JWT authentication token
                  user:
                    $ref: "#/components/schemas/User"
        "400":
          $ref: "#/components/responses/Error"
        "401":
          $ref: "#/components/responses/Error"
        "403":
          description: Email not verified or account inactive
          content:
            application/json:
              schema:
                $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/verify-email:
    post:
      operationId: verifyEmail
      summary: Verify email address
      description: Verifies a user's email address using the verification token sent to their email. The email is extracted from the token itself.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
              properties:
                token:
                  type: string
                  description: Email verification token (contains email and signature)
                  example: dXNlckBleGFtcGxlLmNvbS1hYmMxMjM=
      responses:
        "200":
          description: Email verified successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: email verified successfully
        "400":
          $ref: "#/components/responses/Error"
        "404":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/resend-verification:
    post:
      operationId: resendVerificationEmail
      summary: Resend email verification link
      description: Resends the email verification link to the user's email address.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
      responses:
        "200":
          description: Verification email sent (if email exists and is not verified)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: if the email exists and is not verified, a verification link has been sent
        "400":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/password/reset:
    post:
      operationId: requestPasswordReset
      summary: Request password reset
      description: Sends a password reset token to the user's email address.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
      responses:
        "200":
          description: Password reset email sent (if email exists)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: if the email exists, a password reset link has been sent
        "400":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/password/reset/confirm:
    post:
      operationId: resetPassword
      summary: Reset password using reset token
      description: Resets the user's password using the reset token. The user ID is extracted from the token itself.
      tags:
        - Authentication
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - password
              properties:
                token:
                  type: string
                  description: Password reset token (contains user ID and signature)
                  example: dXNlci1pZC1hYmMxMjM=
                password:
                  type: string
                  format: password
                  minLength: 8
                  example: newpassword123
      responses:
        "200":
          description: Password reset successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: password reset successfully
        "400":
          $ref: "#/components/responses/Error"
        "401":
          $ref: "#/components/responses/Error"
        "403":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/sessions:
    get:
      operationId: listSessions
      summary: List all active sessions
      description: Returns all active sessions for the current authenticated user.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        "200":
          description: List of active sessions
          content:
            application/json:
              schema:
                type: object
                properties:
                  sessions:
                    type: array
                    items:
                      $ref: "#/components/schemas/Session"
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"
    delete:
      operationId: revokeAllSessions
      summary: Revoke all other sessions
      description: Revokes all sessions for the current user except the current session making the request.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        "200":
          description: All other sessions revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: all other sessions revoked successfully
                  revoked_count:
                    type: integer
                    example: 3
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/session:
    get:
      operationId: validateSession
      summary: Validate current session
      description: Validates if the current token/session is still authenticated and valid. Returns the validation status and expiration time.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Session validation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  valid:
                    type: boolean
                    description: Whether the session is valid
                    example: true
                  expires:
                    type: string
                    format: date-time
                    description: Timestamp when the session expires
                    example: 2024-01-01T12:00:00Z
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"
    delete:
      operationId: revokeCurrentSession
      summary: Revoke current session
      description: Revokes the current session, effectively logging out the user.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        "200":
          description: Current session revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: session revoked successfully
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/sessions/{sessionId}:
    delete:
      operationId: revokeSession
      summary: Revoke a specific session
      description: Revokes a specific session by its ID. The session must belong to the current user.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      parameters:
        - name: sessionId
          in: path
          required: true
          schema:
            type: string
            format: uuid
          description: The ID of the session to revoke
      responses:
        "200":
          description: Session revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: session revoked successfully
        "400":
          $ref: "#/components/responses/Error"
        "401":
          $ref: "#/components/responses/Error"
        "403":
          $ref: "#/components/responses/Error"
        "404":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/sessions/batch:
    delete:
      operationId: revokeSessions
      summary: Revoke multiple sessions
      description: Revokes multiple sessions by their IDs. The current session cannot be revoked through this endpoint.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - session_ids
              properties:
                session_ids:
                  type: array
                  items:
                    type: string
                    format: uuid
                  minItems: 1
                  example:
                    [
                      550e8400-e29b-41d4-a716-446655440000,
                      660e8400-e29b-41d4-a716-446655440001,
                    ]
      responses:
        "200":
          description: Batch revocation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: batch revocation completed
                  revoked_count:
                    type: integer
                    example: 2
                  total_count:
                    type: integer
                    example: 3
                  errors:
                    type: array
                    items:
                      type: string
                    description: List of errors for sessions that could not be revoked
                    example:
                      [
                        "cannot revoke current session: 550e8400-e29b-41d4-a716-446655440000",
                      ]
        "400":
          $ref: "#/components/responses/Error"
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"

  /internal/auth/sessions/all:
    delete:
      operationId: revokeAllSessionsAlt
      summary: Revoke all other sessions (alternative endpoint)
      description: Alternative endpoint to revoke all sessions except the current one. Same as DELETE /auth/sessions.
      tags:
        - Authentication
      security:
        - BearerAuth: []
      responses:
        "200":
          description: All other sessions revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: all other sessions revoked successfully
                  revoked_count:
                    type: integer
                    example: 3
        "401":
          $ref: "#/components/responses/Error"
        "500":
          $ref: "#/components/responses/Error"
